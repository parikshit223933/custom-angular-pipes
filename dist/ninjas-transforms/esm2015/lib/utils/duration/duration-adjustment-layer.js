export class DurationAdjustmentLayer {
    constructor(epochsInSeconds) {
        this.durationEntityHash = {};
        this.joiner = ' ';
        this.zerosVisible = false;
        this.shortHand = false;
        this.UnitHash = {
            YEAR: 'year',
            DAY: 'day',
            HOUR: 'hour',
            MINUTE: 'minute',
            SECOND: 'second',
        };
        this.setDurationEntityHash(epochsInSeconds);
        this.setRespectiveForms();
    }
    setLimit(limitToEntity = 'seconds') {
        switch (limitToEntity) {
            case 'years':
                delete this.durationEntityHash.day;
                delete this.durationEntityHash.hour;
                delete this.durationEntityHash.minute;
                delete this.durationEntityHash.second;
                return;
            case 'days':
                delete this.durationEntityHash.hour;
                delete this.durationEntityHash.minute;
                delete this.durationEntityHash.second;
                return;
            case 'hours':
                delete this.durationEntityHash.minute;
                delete this.durationEntityHash.second;
                return;
            case 'minutes':
                delete this.durationEntityHash.second;
                return;
            case 'seconds':
                return;
            default:
                return;
        }
    }
    setJoiner(joiner = '') {
        this.joiner = joiner;
    }
    setShortHand(useShortHand) {
        this.shortHand = useShortHand;
        if (!this.shortHand)
            return;
        if (this.durationEntityHash.year) {
            this.durationEntityHash.year.unit = 'y';
        }
        if (this.durationEntityHash.day) {
            this.durationEntityHash.day.unit = 'd';
        }
        if (this.durationEntityHash.hour) {
            this.durationEntityHash.hour.unit = 'h';
        }
        if (this.durationEntityHash.minute) {
            this.durationEntityHash.minute.unit = 'm';
        }
        if (this.durationEntityHash.second) {
            this.durationEntityHash.second.unit = 's';
        }
    }
    setMinimumDigits(minDigits) {
        if (minDigits === null)
            return;
        Object.values(this.UnitHash).forEach((hKey) => {
            if (!this.durationEntityHash[hKey])
                return;
            if (this.durationEntityHash[hKey].count.length >= minDigits)
                return;
            this.durationEntityHash[hKey].count =
                this.repeatStringNumTimes('0', minDigits - this.durationEntityHash[hKey].count.length) + this.durationEntityHash[hKey].count;
        });
    }
    setZeroVisibility(zeroCountsVisible = false) {
        this.zerosVisible = zeroCountsVisible;
    }
    getDurationString() {
        let entities = [];
        Object.values(this.UnitHash).forEach((hKey) => {
            if (!this.durationEntityHash[hKey])
                return;
            if (parseInt(this.durationEntityHash[hKey].count) == 0 &&
                !this.zerosVisible)
                return;
            entities.push(this.durationEntityHash[hKey].count +
                (this.shortHand ? '' : ' ') +
                this.durationEntityHash[hKey].unit);
        });
        return entities.join(this.joiner);
    }
    setUnitWithCapitalLetter(unitWithCapitalLetter = false) {
        if (!unitWithCapitalLetter)
            return;
        Object.values(this.UnitHash).forEach((hKey) => {
            if (!this.durationEntityHash[hKey])
                return;
            this.durationEntityHash[hKey].unit = this.capitalize(this.durationEntityHash[hKey].unit);
        });
    }
    setDurationEntityHash(epochsInSeconds) {
        this.durationEntityHash = {
            year: {
                count: Math.floor(epochsInSeconds / 60 / 60 / 24 / 365).toString(),
                unit: 'years',
            },
            day: {
                count: Math.floor((epochsInSeconds / 60 / 60 / 24) % 365).toString(),
                unit: 'days',
            },
            hour: {
                count: Math.floor((epochsInSeconds / 60 / 60) % 24).toString(),
                unit: 'hours',
            },
            minute: {
                count: Math.floor((epochsInSeconds / 60) % 60).toString(),
                unit: 'minutes',
            },
            second: {
                count: Math.floor(epochsInSeconds % 60).toString(),
                unit: 'seconds',
            },
        };
    }
    setRespectiveForms() {
        Object.values(this.UnitHash).forEach((hKey) => {
            if (!this.durationEntityHash[hKey])
                return;
            if (parseInt(this.durationEntityHash[hKey].count) != 1)
                return;
            if (this.shortHand)
                return;
            this.durationEntityHash[hKey].unit = this.durationEntityHash[hKey].unit.slice(0, -1);
        });
    }
    repeatStringNumTimes(str, times) {
        if (times <= 0)
            return '';
        return str + this.repeatStringNumTimes(str, times - 1);
    }
    capitalize(s) {
        return s.charAt(0).toUpperCase() + s.slice(1);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHVyYXRpb24tYWRqdXN0bWVudC1sYXllci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25pbmphcy10cmFuc2Zvcm1zL3NyYy9saWIvdXRpbHMvZHVyYXRpb24vZHVyYXRpb24tYWRqdXN0bWVudC1sYXllci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFvREEsTUFBTSxPQUFPLHVCQUF1QjtJQWFsQyxZQUFZLGVBQXVCO1FBWjNCLHVCQUFrQixHQUE0QixFQUFFLENBQUM7UUFDakQsV0FBTSxHQUFXLEdBQUcsQ0FBQztRQUNyQixpQkFBWSxHQUFZLEtBQUssQ0FBQztRQUM5QixjQUFTLEdBQVksS0FBSyxDQUFDO1FBQzNCLGFBQVEsR0FBRztZQUNqQixJQUFJLEVBQUUsTUFBTTtZQUNaLEdBQUcsRUFBRSxLQUFLO1lBQ1YsSUFBSSxFQUFFLE1BQU07WUFDWixNQUFNLEVBQUUsUUFBUTtZQUNoQixNQUFNLEVBQUUsUUFBUTtTQUNqQixDQUFDO1FBR0EsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQzVDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFRCxRQUFRLENBQUMsZ0JBQStDLFNBQVM7UUFDL0QsUUFBUSxhQUFhLEVBQUU7WUFDckIsS0FBSyxPQUFPO2dCQUNWLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQztnQkFDbkMsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDO2dCQUNwQyxPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUM7Z0JBQ3RDLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQztnQkFDdEMsT0FBTztZQUNULEtBQUssTUFBTTtnQkFDVCxPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUM7Z0JBQ3BDLE9BQU8sSUFBSSxDQUFDLGtCQUFr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LE9BQU87WUFFM0IsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQzFELElBQUksQ0FDTCxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFvQyxDQUFDO1FBQ3pELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVPLG9CQUFvQixDQUFDLEdBQVcsRUFBRSxLQUFhO1FBQ3JELElBQUksS0FBSyxJQUFJLENBQUM7WUFBRSxPQUFPLEVBQUUsQ0FBQztRQUMxQixPQUFPLEdBQUcsR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsR0FBRyxFQUFFLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBRU8sVUFBVSxDQUFDLENBQVM7UUFDMUIsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDaEQsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHR5cGUgU21hbGxQbHVyYWxEdXJhdGlvbkVudGl0eVR5cGUgPVxuICB8ICd5ZWFycydcbiAgfCAnZGF5cydcbiAgfCAnaG91cnMnXG4gIHwgJ21pbnV0ZXMnXG4gIHwgJ3NlY29uZHMnO1xuXG5leHBvcnQgdHlwZSBTbWFsbFNpbmd1bGFyRHVyYXRpb25FbnRpdHlUeXBlID1cbiAgfCAneWVhcidcbiAgfCAnZGF5J1xuICB8ICdob3VyJ1xuICB8ICdtaW51dGUnXG4gIHwgJ3NlY29uZCc7XG5cbmV4cG9ydCB0eXBlIFNtYWxsRHVyYXRpb25FbnRpdHlBYmJyZXZpYXRpb25Nb2RlbCA9ICd5JyB8ICdkJyB8ICdoJyB8ICdtJyB8ICdzJztcblxuZXhwb3J0IHR5cGUgQ2FwaXRhbFBsdXJhbER1cmF0aW9uRW50aXR5VHlwZSA9XG4gIHwgJ1llYXJzJ1xuICB8ICdEYXlzJ1xuICB8ICdIb3VycydcbiAgfCAnTWludXRlcydcbiAgfCAnU2Vjb25kcyc7XG5cbmV4cG9ydCB0eXBlIENhcGl0YWxTaW5ndWxhckR1cmF0aW9uRW50aXR5VHlwZSA9XG4gIHwgJ1llYXInXG4gIHwgJ0RheSdcbiAgfCAnSG91cidcbiAgfCAnTWludXRlJ1xuICB8ICdTZWNvbmQnO1xuXG5leHBvcnQgdHlwZSBDYXBpdGFsRHVyYXRpb25FbnRpdHlBYmJyZXZpYXRpb25Nb2RlbCA9XG4gIHwgJ1knXG4gIHwgJ0QnXG4gIHwgJ0gnXG4gIHwgJ00nXG4gIHwgJ1MnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNpbmdsZUVudGl0eURhdGFNb2RlbCB7XG4gIGNvdW50OiBzdHJpbmc7XG4gIHVuaXQ6XG4gICAgfCBTbWFsbFBsdXJhbER1cmF0aW9uRW50aXR5VHlwZVxuICAgIHwgU21hbGxTaW5ndWxhckR1cmF0aW9uRW50aXR5VHlwZVxuICAgIHwgU21hbGxEdXJhdGlvbkVudGl0eUFiYnJldmlhdGlvbk1vZGVsXG4gICAgfCBDYXBpdGFsUGx1cmFsRHVyYXRpb25FbnRpdHlUeXBlXG4gICAgfCBDYXBpdGFsU2luZ3VsYXJEdXJhdGlvbkVudGl0eVR5cGVcbiAgICB8IENhcGl0YWxEdXJhdGlvbkVudGl0eUFiYnJldmlhdGlvbk1vZGVsO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIER1cmF0aW9uRW50aXR5SGFzaE1vZGVsIHtcbiAgW3A6IHN0cmluZ106IFNpbmdsZUVudGl0eURhdGFNb2RlbDtcbn1cblxuZXhwb3J0IGNsYXNzIER1cmF0aW9uQWRqdXN0bWVudExheWVyIHtcbiAgcHJpdmF0ZSBkdXJhdGlvbkVudGl0eUhhc2g6IER1cmF0aW9uRW50aXR5SGFzaE1vZGVsID0ge307XG4gIHByaXZhdGUgam9pbmVyOiBzdHJpbmcgPSAnICc7XG4gIHByaXZhdGUgemVyb3NWaXNpYmxlOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgc2hvcnRIYW5kOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgVW5pdEhhc2ggPSB7XG4gICAgWUVBUjogJ3llYXInLFxuICAgIERBWTogJ2RheScsXG4gICAgSE9VUjogJ2hvdXInLFxuICAgIE1JTlVURTogJ21pbnV0ZScsXG4gICAgU0VDT05EOiAnc2Vjb25kJyxcbiAgfTtcblxuICBjb25zdHJ1Y3RvcihlcG9jaHNJblNlY29uZHM6IG51bWJlcikge1xuICAgIHRoaXMuc2V0RHVyYXRpb25FbnRpdHlIYXNoKGVwb2Noc0luU2Vjb25kcyk7XG4gICAgdGhpcy5zZXRSZXNwZWN0aXZlRm9ybXMoKTtcbiAgfVxuXG4gIHNldExpbWl0KGxpbWl0VG9FbnRpdHk6IFNtYWxsUGx1cmFsRHVyYXRpb25FbnRpdHlUeXBlID0gJ3NlY29uZHMnKSB7XG4gICAgc3dpdGNoIChsaW1pdFRvRW50aXR5KSB7XG4gICAgICBjYXNlICd5ZWFycyc6XG4gICAgICAgIGRlbGV0ZSB0aGlzLmR1cmF0aW9uRW50aXR5SGFzaC5kYXk7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmR1cmF0aW9uRW50aXR5SGFzaC5ob3VyO1xuICAgICAgICBkZWxldGUgdGhpcy5kdXJhdGlvbkVudGl0eUhhc2gubWludXRlO1xuICAgICAgICBkZWxldGUgdGhpcy5kdXJhdGlvbkVudGl0eUhhc2guc2Vjb25kO1xuICAgICAgICByZXR1cm47XG4gICAgICBjYXNlICdkYXlzJzpcbiAgICAgICAgZGVsZXRlIHRoaXMuZHVyYXRpb25FbnRpdHlIYXNoLmhvdXI7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmR1cmF0aW9uRW50aXR5SGFzaC5taW51dGU7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmR1cmF0aW9uRW50aXR5SGFzaC5zZWNvbmQ7XG4gICAgICAgIHJldHVybjtcbiAgICAgIGNhc2UgJ2hvdXJzJzpcbiAgICAgICAgZGVsZXRlIHRoaXMuZHVyYXRpb25FbnRpdHlIYXNoLm1pbnV0ZTtcbiAgICAgICAgZGVsZXRlIHRoaXMuZHVyYXRpb25FbnRpdHlIYXNoLnNlY29uZDtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgY2FzZSAnbWludXRlcyc6XG4gICAgICAgIGRlbGV0ZSB0aGlzLmR1cmF0aW9uRW50aXR5SGFzaC5zZWNvbmQ7XG4gICAgICAgIHJldHVybjtcbiAgICAgIGNhc2UgJ3NlY29uZHMnOlxuICAgICAgICByZXR1cm47XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbiAgc2V0Sm9pbmVyKGpvaW5lcjogc3RyaW5nID0gJycpIHtcbiAgICB0aGlzLmpvaW5lciA9IGpvaW5lcjtcbiAgfVxuXG4gIHNldFNob3J0SGFuZCh1c2VTaG9ydEhhbmQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnNob3J0SGFuZCA9IHVzZVNob3J0SGFuZDtcbiAgICBpZiAoIXRoaXMuc2hvcnRIYW5kKSByZXR1cm47XG5cbiAgICBpZiAodGhpcy5kdXJhdGlvbkVudGl0eUhhc2gueWVhcikge1xuICAgICAgdGhpcy5kdXJhdGlvbkVudGl0eUhhc2gueWVhci51bml0ID0gJ3knO1xuICAgIH1cbiAgICBpZiAodGhpcy5kdXJhdGlvbkVudGl0eUhhc2guZGF5KSB7XG4gICAgICB0aGlzLmR1cmF0aW9uRW50aXR5SGFzaC5kYXkudW5pdCA9ICdkJztcbiAgICB9XG4gICAgaWYgKHRoaXMuZHVyYXRpb25FbnRpdHlIYXNoLmhvdXIpIHtcbiAgICAgIHRoaXMuZHVyYXRpb25FbnRpdHlIYXNoLmhvdXIudW5pdCA9ICdoJztcbiAgICB9XG4gICAgaWYgKHRoaXMuZHVyYXRpb25FbnRpdHlIYXNoLm1pbnV0ZSkge1xuICAgICAgdGhpcy5kdXJhdGlvbkVudGl0eUhhc2gubWludXRlLnVuaXQgPSAnbSc7XG4gICAgfVxuICAgIGlmICh0aGlzLmR1cmF0aW9uRW50aXR5SGFzaC5zZWNvbmQpIHtcbiAgICAgIHRoaXMuZHVyYXRpb25FbnRpdHlIYXNoLnNlY29uZC51bml0ID0gJ3MnO1xuICAgIH1cbiAgfVxuXG4gIHNldE1pbmltdW1EaWdpdHMobWluRGlnaXRzOiBudW1iZXIgfCBudWxsKSB7XG4gICAgaWYgKG1pbkRpZ2l0cyA9PT0gbnVsbCkgcmV0dXJuO1xuICAgIE9iamVjdC52YWx1ZXModGhpcy5Vbml0SGFzaCkuZm9yRWFjaCgoaEtleSkgPT4ge1xuICAgICAgaWYgKCF0aGlzLmR1cmF0aW9uRW50aXR5SGFzaFtoS2V5XSkgcmV0dXJuO1xuXG4gICAgICBpZiAodGhpcy5kdXJhdGlvbkVudGl0eUhhc2hbaEtleV0uY291bnQubGVuZ3RoID49IG1pbkRpZ2l0cykgcmV0dXJuO1xuXG4gICAgICB0aGlzLmR1cmF0aW9uRW50aXR5SGFzaFtoS2V5XS5jb3VudCA9XG4gICAgICAgIHRoaXMucmVwZWF0U3RyaW5nTnVtVGltZXMoXG4gICAgICAgICAgJzAnLFxuICAgICAgICAgIG1pbkRpZ2l0cyAtIHRoaXMuZHVyYXRpb25FbnRpdHlIYXNoW2hLZXldLmNvdW50Lmxlbmd0aFxuICAgICAgICApICsgdGhpcy5kdXJhdGlvbkVudGl0eUhhc2hbaEtleV0uY291bnQ7XG4gICAgfSk7XG4gIH1cblxuICBzZXRaZXJvVmlzaWJpbGl0eSh6ZXJvQ291bnRzVmlzaWJsZTogYm9vbGVhbiA9IGZhbHNlKSB7XG4gICAgdGhpcy56ZXJvc1Zpc2libGUgPSB6ZXJvQ291bnRzVmlzaWJsZTtcbiAgfVxuXG4gIGdldER1cmF0aW9uU3RyaW5nKCkge1xuICAgIGxldCBlbnRpdGllczogc3RyaW5nW10gPSBbXTtcbiAgICBPYmplY3QudmFsdWVzKHRoaXMuVW5pdEhhc2gpLmZvckVhY2goKGhLZXkpID0+IHtcbiAgICAgIGlmICghdGhpcy5kdXJhdGlvbkVudGl0eUhhc2hbaEtleV0pIHJldHVybjtcbiAgICAgIGlmIChcbiAgICAgICAgcGFyc2VJbnQodGhpcy5kdXJhdGlvbkVudGl0eUhhc2hbaEtleV0uY291bnQpID09IDAgJiZcbiAgICAgICAgIXRoaXMuemVyb3NWaXNpYmxlXG4gICAgICApXG4gICAgICAgIHJldHVybjtcblxuICAgICAgZW50aXRpZXMucHVzaChcbiAgICAgICAgdGhpcy5kdXJhdGlvbkVudGl0eUhhc2hbaEtleV0uY291bnQgK1xuICAgICAgICAgICh0aGlzLnNob3J0SGFuZCA/ICcnIDogJyAnKSArXG4gICAgICAgICAgdGhpcy5kdXJhdGlvbkVudGl0eUhhc2hbaEtleV0udW5pdFxuICAgICAgKTtcbiAgICB9KTtcbiAgICByZXR1cm4gZW50aXRpZXMuam9pbih0aGlzLmpvaW5lcik7XG4gIH1cblxuICBzZXRVbml0V2l0aENhcGl0YWxMZXR0ZXIodW5pdFdpdGhDYXBpdGFsTGV0dGVyOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICBpZiAoIXVuaXRXaXRoQ2FwaXRhbExldHRlcikgcmV0dXJuO1xuXG4gICAgT2JqZWN0LnZhbHVlcyh0aGlzLlVuaXRIYXNoKS5mb3JFYWNoKChoS2V5KSA9PiB7XG4gICAgICBpZiAoIXRoaXMuZHVyYXRpb25FbnRpdHlIYXNoW2hLZXldKSByZXR1cm47XG4gICAgICB0aGlzLmR1cmF0aW9uRW50aXR5SGFzaFtoS2V5XS51bml0ID0gdGhpcy5jYXBpdGFsaXplKFxuICAgICAgICB0aGlzLmR1cmF0aW9uRW50aXR5SGFzaFtoS2V5XS51bml0XG4gICAgICApIGFzXG4gICAgICAgIHwgQ2FwaXRhbFBsdXJhbER1cmF0aW9uRW50aXR5VHlwZVxuICAgICAgICB8IENhcGl0YWxTaW5ndWxhckR1cmF0aW9uRW50aXR5VHlwZVxuICAgICAgICB8IENhcGl0YWxEdXJhdGlvbkVudGl0eUFiYnJldmlhdGlvbk1vZGVsO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXREdXJhdGlvbkVudGl0eUhhc2goZXBvY2hzSW5TZWNvbmRzOiBudW1iZXIpIHtcbiAgICB0aGlzLmR1cmF0aW9uRW50aXR5SGFzaCA9IHtcbiAgICAgIHllYXI6IHtcbiAgICAgICAgY291bnQ6IE1hdGguZmxvb3IoZXBvY2hzSW5TZWNvbmRzIC8gNjAgLyA2MCAvIDI0IC8gMzY1KS50b1N0cmluZygpLFxuICAgICAgICB1bml0OiAneWVhcnMnLFxuICAgICAgfSxcbiAgICAgIGRheToge1xuICAgICAgICBjb3VudDogTWF0aC5mbG9vcigoZXBvY2hzSW5TZWNvbmRzIC8gNjAgLyA2MCAvIDI0KSAlIDM2NSkudG9TdHJpbmcoKSxcbiAgICAgICAgdW5pdDogJ2RheXMnLFxuICAgICAgfSxcbiAgICAgIGhvdXI6IHtcbiAgICAgICAgY291bnQ6IE1hdGguZmxvb3IoKGVwb2Noc0luU2Vjb25kcyAvIDYwIC8gNjApICUgMjQpLnRvU3RyaW5nKCksXG4gICAgICAgIHVuaXQ6ICdob3VycycsXG4gICAgICB9LFxuICAgICAgbWludXRlOiB7XG4gICAgICAgIGNvdW50OiBNYXRoLmZsb29yKChlcG9jaHNJblNlY29uZHMgLyA2MCkgJSA2MCkudG9TdHJpbmcoKSxcbiAgICAgICAgdW5pdDogJ21pbnV0ZXMnLFxuICAgICAgfSxcbiAgICAgIHNlY29uZDoge1xuICAgICAgICBjb3VudDogTWF0aC5mbG9vcihlcG9jaHNJblNlY29uZHMgJSA2MCkudG9TdHJpbmcoKSxcbiAgICAgICAgdW5pdDogJ3NlY29uZHMnLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRSZXNwZWN0aXZlRm9ybXMoKSB7XG4gICAgT2JqZWN0LnZhbHVlcyh0aGlzLlVuaXRIYXNoKS5mb3JFYWNoKChoS2V5KSA9PiB7XG4gICAgICBpZiAoIXRoaXMuZHVyYXRpb25FbnRpdHlIYXNoW2hLZXldKSByZXR1cm47XG4gICAgICBpZiAocGFyc2VJbnQodGhpcy5kdXJhdGlvbkVudGl0eUhhc2hbaEtleV0uY291bnQpICE9IDEpIHJldHVybjtcbiAgICAgIGlmICh0aGlzLnNob3J0SGFuZCkgcmV0dXJuO1xuXG4gICAgICB0aGlzLmR1cmF0aW9uRW50aXR5SGFzaFtoS2V5XS51bml0ID0gdGhpcy5kdXJhdGlvbkVudGl0eUhhc2hbXG4gICAgICAgIGhLZXlcbiAgICAgIF0udW5pdC5zbGljZSgwLCAtMSkgYXMgU21hbGxTaW5ndWxhckR1cmF0aW9uRW50aXR5VHlwZTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVwZWF0U3RyaW5nTnVtVGltZXMoc3RyOiBzdHJpbmcsIHRpbWVzOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGlmICh0aW1lcyA8PSAwKSByZXR1cm4gJyc7XG4gICAgcmV0dXJuIHN0ciArIHRoaXMucmVwZWF0U3RyaW5nTnVtVGltZXMoc3RyLCB0aW1lcyAtIDEpO1xuICB9XG5cbiAgcHJpdmF0ZSBjYXBpdGFsaXplKHM6IHN0cmluZykge1xuICAgIHJldHVybiBzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcy5zbGljZSgxKTtcbiAgfVxufVxuIl19